<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<title>AIWtaxi â€“ áƒ›áƒ«áƒ¦áƒáƒšáƒ˜áƒ¡ áƒ™áƒáƒ‘áƒ˜áƒœáƒ”áƒ¢áƒ˜</title>

<style>
    body {
        background: black;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 25px;
    }
    h1 {
        color: #FFD000;
        font-size: 30px;
        margin-bottom: 30px;
    }
    .balance {
        font-size: 55px;
        color: #FFD000;
        margin-top: 10px;
        margin-bottom: 25px;
    }
    button {
        background: #5AB0FF;
        border: none;
        padding: 18px 40px;
        border-radius: 100px;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
        color: white;
        margin-top: 25px;
    }
</style>
</head>

<body>

<h1>AIWtaxi â€“ áƒ›áƒ«áƒ¦áƒáƒšáƒ˜áƒ¡ áƒ™áƒáƒ‘áƒ˜áƒœáƒ”áƒ¢áƒ˜</h1>

<h2>áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜:</h2>
<div id="driverPhone" style="font-size:22px; margin-bottom:20px;"></div>

<h2>áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜:</h2>
<div id="balance" class="balance">áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒâ€¦</div>

<button onclick="alert('áƒ’áƒáƒ“áƒáƒ áƒ˜áƒªáƒ®áƒ•áƒ˜áƒ¡ áƒ¤áƒáƒœáƒ¯áƒáƒ áƒ áƒ›áƒ–áƒáƒ“áƒ“áƒ”áƒ‘áƒ')">
    áƒ’áƒáƒ“áƒáƒ áƒ˜áƒªáƒ®áƒ•áƒ
</button>

<script>

// áƒáƒ¥ áƒ©áƒáƒ¡áƒ•áƒáƒ› áƒ¨áƒ”áƒœáƒ¡ áƒ›áƒ˜áƒ”áƒ  áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ£áƒš áƒ“áƒáƒ®áƒ•áƒ”áƒ¬áƒ˜áƒš áƒ’áƒáƒ¡áƒáƒ¦áƒ”áƒ‘áƒ”áƒ‘áƒ¡:
const API_KEY = "tlQGatuaTrXFLehrGJOxzcbumRtmyNaKjdvH";
const PARK_ID = "taxi/park/3570960d7c3f4a4eb189bed587fc54d7";

const phone = localStorage.getItem("driver_phone");
document.getElementById("driverPhone").innerText = phone;


// ğŸ”¥ 1) áƒ›áƒ«áƒ¦áƒáƒšáƒ˜áƒ¡ áƒ«áƒ”áƒ‘áƒœáƒ áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜áƒ¡ áƒ›áƒ˜áƒ®áƒ”áƒ“áƒ•áƒ˜áƒ—
async function getDriverId() {
    const url = `https://fleet-api.taxi.yandex.net/v1/parks/driver-profiles/list`;

    const body = {
        query: {
            park: { id: PARK_ID.replace("taxi/park/", "") },
            text: phone
        },
        limit: 1
    };

    const res = await fetch(url, {
        method: "POST",
        headers: {
            "X-Client-ID": PARK_ID,
            "X-API-Key": API_KEY,
            "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
    });

    const data = await res.json();

    if (!data.driver_profiles || data.driver_profiles.length === 0) {
        document.getElementById("balance").innerText = "áƒ›áƒ«áƒ¦áƒáƒšáƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ";
        throw "Driver not found";
    }

    return data.driver_profiles[0].driver_profile.id;
}


// ğŸ”¥ 2) áƒ›áƒ«áƒ¦áƒáƒšáƒ˜áƒ¡ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜áƒ¡ áƒáƒ›áƒáƒ¦áƒ”áƒ‘áƒ
async function getDriverBalance(driverId) {
    const url = `https://fleet-api.taxi.yandex.net/v2/parks/driver-profiles/balances/list`;

    const body = {
        query: {
            park: { id: PARK_ID.replace("taxi/park/", "") },
            driver_profile: { id: [driverId] }
        }
    };

    const res = await fetch(url, {
        method: "POST",
        headers: {
            "X-Client-ID": PARK_ID,
            "X-API-Key": API_KEY,
            "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
    });

    const data = await res.json();

    const b = data.accounts[0].balance;
    return b;
}


// ğŸš€ 3) áƒ’áƒáƒ¨áƒ•áƒ”áƒ‘áƒ
(async () => {
    try {
        const driverId = await getDriverId();
        const balance = await getDriverBalance(driverId);

        document.getElementById("balance").innerText = balance + " â‚¾";

    } catch (e) {
        console.log(e);
    }
})();

</script>

</body>
</html>
